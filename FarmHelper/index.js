villages = [{"target":"488|624", "ID":15563, "origin":"507|627", "launchID":14506, "increment":948431}, {"target":"489|620", "ID":16877, "origin":"507|627", "launchID":14506, "increment":5000000}, {"target":"489|626", "ID":15495, "origin":"507|627", "launchID":14506, "increment":1269509}, {"target":"489|631", "ID":17247, "origin":"507|627", "launchID":14506, "increment":1170449}, {"target":"490|618", "ID":13616, "origin":"510|620", "launchID":14503, "increment":1021578}, {"target":"490|635", "ID":17591, "origin":"507|627", "launchID":14506, "increment":1363636}, {"target":"490|637", "ID":19103, "origin":"507|627", "launchID":14506, "increment":720614}, {"target":"491|624", "ID":14678, "origin":"507|627", "launchID":14506, "increment":1363636}, {"target":"491|625", "ID":15728, "origin":"507|627", "launchID":14506, "increment":894763}, {"target":"491|627", "ID":15702, "origin":"507|627", "launchID":14506, "increment":2142857}, {"target":"492|617", "ID":13364, "origin":"510|620", "launchID":14503, "increment":894763}, {"target":"492|624", "ID":15798, "origin":"507|627", "launchID":14506, "increment":1269509}, {"target":"492|628", "ID":15517, "origin":"507|627", "launchID":14506, "increment":2142857}, {"target":"492|629", "ID":16522, "origin":"507|627", "launchID":14506, "increment":1269509}, {"target":"492|634", "ID":17161, "origin":"507|627", "launchID":14506, "increment":1269509}, {"target":"492|640", "ID":19699, "origin":"507|627", "launchID":14506, "increment":948431}, {"target":"493|617", "ID":13238, "origin":"510|620", "launchID":14503, "increment":2142857}, {"target":"493|630", "ID":16495, "origin":"507|627", "launchID":14506, "increment":1363636}, {"target":"493|631", "ID":18105, "origin":"507|627", "launchID":14506, "increment":2142857}, {"target":"494|612", "ID":12267, "origin":"510|620", "launchID":14503, "increment":901920}, {"target":"494|626", "ID":15339, "origin":"507|627", "launchID":14506, "increment":859758}, {"target":"494|629", "ID":17199, "origin":"507|627", "launchID":14506, "increment":1104581}, {"target":"495|630", "ID":16899, "origin":"507|627", "launchID":14506, "increment":948431}, {"target":"495|631", "ID":17789, "origin":"507|627", "launchID":14506, "increment":894763}, {"target":"495|641", "ID":20677, "origin":"507|627", "launchID":14506, "increment":1363636}, {"target":"497|613", "ID":12481, "origin":"510|620", "launchID":14503, "increment":1711505}, {"target":"497|614", "ID":12824, "origin":"510|620", "launchID":14503, "increment":901920}, {"target":"497|623", "ID":14431, "origin":"507|627", "launchID":14506, "increment":1175160}, {"target":"498|612", "ID":13105, "origin":"510|620", "launchID":14503, "increment":665166}, {"target":"498|617", "ID":13170, "origin":"510|620", "launchID":14503, "increment":901920}, {"target":"498|627", "ID":15535, "origin":"507|627", "launchID":14506, "increment":1269509}, {"target":"498|633", "ID":17633, "origin":"507|627", "launchID":14506, "increment":1104581}, {"target":"498|641", "ID":19781, "origin":"507|627", "launchID":14506, "increment":1919241}, {"target":"499|618", "ID":13330, "origin":"510|620", "launchID":14503, "increment":990038}, {"target":"499|633", "ID":17066, "origin":"507|627", "launchID":14506, "increment":802861}, {"target":"499|642", "ID":19758, "origin":"507|627", "launchID":14506, "increment":2142857}, {"target":"500|610", "ID":12312, "origin":"510|620", "launchID":14503, "increment":1919241}, {"target":"500|613", "ID":12142, "origin":"510|620", "launchID":14503, "increment":1000000}, {"target":"500|618", "ID":13300, "origin":"510|620", "launchID":14503, "increment":2142857}, {"target":"500|620", "ID":14360, "origin":"507|627", "launchID":14506, "increment":1269509}, {"target":"500|635", "ID":19158, "origin":"507|627", "launchID":14506, "increment":1269509}, {"target":"500|637", "ID":16166, "origin":"507|627", "launchID":14506, "increment":1711505}, {"target":"501|625", "ID":16003, "origin":"507|627", "launchID":14506, "increment":2142857}, {"target":"501|634", "ID":17262, "origin":"507|627", "launchID":14506, "increment":2142857}, {"target":"501|635", "ID":18219, "origin":"507|627", "launchID":14506, "increment":2142857}, {"target":"502|611", "ID":12898, "origin":"510|620", "launchID":14503, "increment":2142857}, {"target":"502|615", "ID":13728, "origin":"510|620", "launchID":14503, "increment":1269509}, {"target":"502|627", "ID":16167, "origin":"507|627", "launchID":14506, "increment":1919241}, {"target":"502|628", "ID":16406, "origin":"507|627", "launchID":14506, "increment":1875000}, {"target":"502|646", "ID":20601, "origin":"507|627", "launchID":14506, "increment":2142857}, {"target":"503|628", "ID":16164, "origin":"507|627", "launchID":14506, "increment":1000000}, {"target":"503|636", "ID":17883, "origin":"507|627", "launchID":14506, "increment":2142857}, {"target":"503|637", "ID":19143, "origin":"507|627", "launchID":14506, "increment":693443}, {"target":"503|642", "ID":20201, "origin":"507|627", "launchID":14506, "increment":1701531}, {"target":"503|643", "ID":20440, "origin":"507|627", "launchID":14506, "increment":5000000}, {"target":"504|617", "ID":13194, "origin":"510|620", "launchID":14503, "increment":1187538}, {"target":"504|618", "ID":13703, "origin":"510|620", "launchID":14503, "increment":1363636}, {"target":"504|636", "ID":18194, "origin":"507|627", "launchID":14506, "increment":1269509}, {"target":"504|640", "ID":19352, "origin":"507|627", "launchID":14506, "increment":894763}, {"target":"504|646", "ID":20423, "origin":"507|627", "launchID":14506, "increment":1363636}, {"target":"505|633", "ID":18521, "origin":"507|627", "launchID":14506, "increment":1250000}, {"target":"506|609", "ID":11437, "origin":"510|620", "launchID":14503, "increment":2142857}, {"target":"506|612", "ID":13296, "origin":"510|620", "launchID":14503, "increment":1175160}, {"target":"506|618", "ID":13260, "origin":"510|620", "launchID":14503, "increment":1269509}, {"target":"506|620", "ID":14422, "origin":"510|620", "launchID":14503, "increment":1104581}, {"target":"506|639", "ID":18825, "origin":"507|627", "launchID":14506, "increment":2142857}, {"target":"506|646", "ID":21056, "origin":"507|627", "launchID":14506, "increment":2142857}, {"target":"507|612", "ID":12928, "origin":"510|620", "launchID":14503, "increment":901920}, {"target":"507|620", "ID":13868, "origin":"510|620", "launchID":14503, "increment":1648352}, {"target":"507|621", "ID":14061, "origin":"510|620", "launchID":14503, "increment":1000000}, {"target":"507|623", "ID":14382, "origin":"510|620", "launchID":14503, "increment":894763}, {"target":"507|628", "ID":16045, "origin":"507|627", "launchID":14506, "increment":894763}, {"target":"507|632", "ID":17258, "origin":"507|627", "launchID":14506, "increment":1875000}, {"target":"507|633", "ID":17932, "origin":"507|627", "launchID":14506, "increment":809566}, {"target":"507|634", "ID":17572, "origin":"507|627", "launchID":14506, "increment":1175160}, {"target":"508|612", "ID":12109, "origin":"510|620", "launchID":14503, "increment":5000000}, {"target":"508|618", "ID":13694, "origin":"510|620", "launchID":14503, "increment":1048951}, {"target":"508|619", "ID":14883, "origin":"510|620", "launchID":14503, "increment":1363636}, {"target":"508|640", "ID":20365, "origin":"507|627", "launchID":14506, "increment":5000000}, {"target":"508|646", "ID":21315, "origin":"507|627", "launchID":14506, "increment":2142857}, {"target":"509|620", "ID":14923, "origin":"510|620", "launchID":14503, "increment":2142857}, {"target":"509|636", "ID":18661, "origin":"507|627", "launchID":14506, "increment":783252}, {"target":"509|638", "ID":20106, "origin":"507|627", "launchID":14506, "increment":1269509}, {"target":"509|639", "ID":19124, "origin":"507|627", "launchID":14506, "increment":1363636}, {"target":"510|613", "ID":12344, "origin":"510|620", "launchID":14503, "increment":1363636}, {"target":"510|626", "ID":16579, "origin":"507|627", "launchID":14506, "increment":1363636}, {"target":"510|631", "ID":16550, "origin":"507|627", "launchID":14506, "increment":1104581}, {"target":"510|641", "ID":20759, "origin":"507|627", "launchID":14506, "increment":1919241}, {"target":"510|642", "ID":19752, "origin":"507|627", "launchID":14506, "increment":1104581}, {"target":"511|619", "ID":13658, "origin":"512|621", "launchID":14507, "increment":1363636}, {"target":"511|620", "ID":13905, "origin":"512|621", "launchID":14507, "increment":903969}, {"target":"511|625", "ID":16232, "origin":"507|627", "launchID":14506, "increment":1269509}, {"target":"512|612", "ID":12339, "origin":"512|621", "launchID":14507, "increment":1175160}, {"target":"512|635", "ID":17845, "origin":"507|627", "launchID":14506, "increment":2142857}, {"target":"512|639", "ID":20132, "origin":"507|627", "launchID":14506, "increment":2142857}, {"target":"512|640", "ID":20794, "origin":"507|627", "launchID":14506, "increment":937500}, {"target":"512|641", "ID":20520, "origin":"507|627", "launchID":14506, "increment":1021578}, {"target":"513|609", "ID":11502, "origin":"510|620", "launchID":14503, "increment":1919241}, {"target":"513|620", "ID":14033, "origin":"512|621", "launchID":14507, "increment":2142857}, {"target":"513|621", "ID":15061, "origin":"512|621", "launchID":14507, "increment":1269509}, {"target":"513|643", "ID":20060, "origin":"507|627", "launchID":14506, "increment":1269509}, {"target":"514|625", "ID":15524, "origin":"507|627", "launchID":14506, "increment":1104581}, {"target":"514|628", "ID":16143, "origin":"507|627", "launchID":14506, "increment":901920}, {"target":"514|635", "ID":19457, "origin":"507|627", "launchID":14506, "increment":1919241}, {"target":"515|610", "ID":12453, "origin":"510|620", "launchID":14503, "increment":1269509}, {"target":"515|612", "ID":13185, "origin":"512|621", "launchID":14507, "increment":892029}, {"target":"515|625", "ID":15168, "origin":"507|627", "launchID":14506, "increment":853252}, {"target":"515|626", "ID":16383, "origin":"507|627", "launchID":14506, "increment":1187538}, {"target":"516|610", "ID":11923, "origin":"510|620", "launchID":14503, "increment":1269509}, {"target":"516|614", "ID":12784, "origin":"512|621", "launchID":14507, "increment":2142857}, {"target":"516|617", "ID":13751, "origin":"512|621", "launchID":14507, "increment":1187538}, {"target":"516|618", "ID":14132, "origin":"512|621", "launchID":14507, "increment":1919241}, {"target":"516|622", "ID":15520, "origin":"512|621", "launchID":14507, "increment":2142857}, {"target":"516|626", "ID":15774, "origin":"507|627", "launchID":14506, "increment":1000000}, {"target":"516|631", "ID":18286, "origin":"507|627", "launchID":14506, "increment":1919241}, {"target":"516|636", "ID":18213, "origin":"507|627", "launchID":14506, "increment":2142857}, {"target":"517|617", "ID":14646, "origin":"512|621", "launchID":14507, "increment":1021578}, {"target":"517|629", "ID":16552, "origin":"507|627", "launchID":14506, "increment":894763}, {"target":"517|631", "ID":17933, "origin":"507|627", "launchID":14506, "increment":1269509}, {"target":"517|637", "ID":19060, "origin":"507|627", "launchID":14506, "increment":1269509}, {"target":"518|611", "ID":12979, "origin":"510|620", "launchID":14503, "increment":1919241}, {"target":"518|614", "ID":13134, "origin":"512|621", "launchID":14507, "increment":939466}, {"target":"518|619", "ID":14067, "origin":"510|620", "launchID":14503, "increment":1363636}, {"target":"518|622", "ID":14998, "origin":"507|627", "launchID":14506, "increment":1363636}, {"target":"518|623", "ID":16249, "origin":"507|627", "launchID":14506, "increment":1175160}, {"target":"518|627", "ID":16241, "origin":"507|627", "launchID":14506, "increment":1048951}, {"target":"518|631", "ID":17543, "origin":"507|627", "launchID":14506, "increment":1363636}, {"target":"518|641", "ID":21179, "origin":"507|627", "launchID":14506, "increment":2142857}, {"target":"519|619", "ID":14549, "origin":"510|620", "launchID":14503, "increment":1363636}, {"target":"519|622", "ID":14482, "origin":"507|627", "launchID":14506, "increment":815421}, {"target":"519|634", "ID":18196, "origin":"507|627", "launchID":14506, "increment":2142857}, {"target":"520|615", "ID":13316, "origin":"510|620", "launchID":14503, "increment":1269509}, {"target":"520|620", "ID":15736, "origin":"510|620", "launchID":14503, "increment":2142857}, {"target":"520|622", "ID":14993, "origin":"507|627", "launchID":14506, "increment":2142857}, {"target":"520|634", "ID":19196, "origin":"507|627", "launchID":14506, "increment":1363636}, {"target":"521|613", "ID":13334, "origin":"510|620", "launchID":14503, "increment":853252}, {"target":"521|615", "ID":13377, "origin":"510|620", "launchID":14503, "increment":1363636}, {"target":"521|626", "ID":16212, "origin":"507|627", "launchID":14506, "increment":802861}, {"target":"521|628", "ID":17318, "origin":"507|627", "launchID":14506, "increment":1363636}, {"target":"521|630", "ID":17401, "origin":"507|627", "launchID":14506, "increment":1476339}, {"target":"521|635", "ID":18058, "origin":"507|627", "launchID":14506, "increment":5000000}, {"target":"522|637", "ID":18960, "origin":"507|627", "launchID":14506, "increment":2142857}, {"target":"522|640", "ID":19230, "origin":"507|627", "launchID":14506, "increment":1919241}, {"target":"523|617", "ID":14449, "origin":"510|620", "launchID":14503, "increment":1269509}, {"target":"523|625", "ID":15835, "origin":"507|627", "launchID":14506, "increment":1363636}, {"target":"523|627", "ID":16245, "origin":"507|627", "launchID":14506, "increment":948431}, {"target":"523|637", "ID":18904, "origin":"507|627", "launchID":14506, "increment":2142857}, {"target":"524|623", "ID":16030, "origin":"507|627", "launchID":14506, "increment":1269509}, {"target":"524|626", "ID":17319, "origin":"507|627", "launchID":14506, "increment":1269509}, {"target":"524|627", "ID":16059, "origin":"507|627", "launchID":14506, "increment":813150}, {"target":"524|630", "ID":15735, "origin":"507|627", "launchID":14506, "increment":1363636}, {"target":"525|631", "ID":17798, "origin":"507|627", "launchID":14506, "increment":901920}, {"target":"525|634", "ID":18384, "origin":"507|627", "launchID":14506, "increment":1919241}, {"target":"525|635", "ID":17724, "origin":"507|627", "launchID":14506, "increment":5000000}, {"target":"526|625", "ID":15732, "origin":"507|627", "launchID":14506, "increment":1363636}, {"target":"526|632", "ID":18679, "origin":"507|627", "launchID":14506, "increment":1269509}, {"target":"526|633", "ID":17721, "origin":"507|627", "launchID":14506, "increment":1269509}]

function initialize() {
    for (let i = 0; i < villages.length; i++) {
        date = new Date();
        date_ms = date.getTime();
        launch = new Date(date_ms);
        launch = new Date(date_ms + villages[i].increment);
        villages[i].launch = launch;

    }

    sortVillages();
    displayVillages();
}

function sortVillages() {
    villages = villages.sort((v1, v2) => (v1.launch > v2.launch) ? 1 : (v1.launch < v2.launch) ? -1 : 0);
}

function displayVillages() {
    wrapper = document.getElementById("villageList");

    for (let i = 0; i < villages.length; i++) {
        div = document.createElement("div");
        div.id = villages[i].ID;
        div.className = "village"

        launchFrom = document.createElement("a");
        launchFrom.setAttribute("href","https://en129.tribalwars.net/game.php?village="+villages[i].launchID+"&screen=overview");
        launchFrom.setAttribute("target","_blank");

        launchTo = document.createElement("a");
        launchTo.setAttribute("href","https://en129.tribalwars.net/game.php?village="+villages[i].launchID+"&screen=info_village&id="+villages[i].ID);
        launchTo.setAttribute("target","_blank");

        launchTime = document.createElement("span");

        launchButton = document.createElement("a");
        launchButton.className = "button";
        launchButton.id = villages[i].ID + "b";

        launchFrom.innerHTML = villages[i].origin;
        launchTo.innerHTML = villages[i].target;

        launchButton.innerHTML = "SEND";
        launchButton.setAttribute("href","https://en129.tribalwars.net/game.php?village="+villages[i].launchID+"&screen=place&target="+villages[i].ID+"&light=1");
        launchButton.setAttribute("target","_blank");


        date = villages[i].launch;
        displayDate = new Date(date.getTime())
        displayDate.setHours(displayDate.getHours() + 1)

        launchTime.innerHTML = displayDate.toUTCString().slice(0, -3);
        launchTime.id = villages[i].ID + "d"

        div.appendChild(launchFrom);
        div.appendChild(launchTo);
        div.appendChild(launchTime);
        div.appendChild(launchButton);

        wrapper.appendChild(div);
    }
}

function addButtonClick() {
    btns = document.querySelectorAll(".button");
    for (let i = 0; i < btns.length; i++) {
        btns[i].addEventListener("click", sendFarm);
    }
}

function buttonState() {

    current = new Date()
    console.log(current)
    for (let i = 0; i < villages.length; i++) {
        btn = document.getElementById(villages[i].ID + "b");
        div = document.getElementById(villages[i].ID)
        launch = villages[i].launch;
        // console.log(current,launch)
        if (launch > current) {
            // div.style.display = "none";
            div.style.opacity = 0.2;
        } else {
            div.style.opacity = 1;
        }
    }
}

function setIntervals() {
    btnState = setInterval(buttonState, 500);
}

function sendFarm() {
    id = this.id.slice(0, -1);
    timeDiv = document.getElementById(id + "d");
    btnDiv = document.getElementById(id + "b");

    for (let i = 0; i < villages.length; i++) {
        if (villages[i].ID == id) {
            ms = villages[i].launch.getTime();
            ms += villages[i].increment;

            villages[i].launch = new Date(ms);

            displayDate = new Date(villages[i].launch.getTime())
            displayDate.setHours(displayDate.getHours() + 1)

            timeDiv.innerHTML = displayDate.toUTCString().slice(0, -3);

            reorder(id);
        }
    }
}

function reorder(id) {
    divs = document.querySelectorAll(".village");

    for (let i = 0; i < villages.length; i++) {
        if (villages[i].ID == id) {
            launch = villages[i].launch;
        }
    }

    done = false;
    for (let i = 0; i < divs.length; i++) {
        divID = divs[i].id;
        for (let j = 0; j < villages.length; j++) {
            if (villages[j].ID == divID) {
                launchCheck = villages[j].launch;
                if (launch < launchCheck && done == false) {
                    done = true;
                    document.getElementById("villageList").insertBefore(document.getElementById(id), document.getElementById(divID));
                }
                break;
            }
        }
    }
}